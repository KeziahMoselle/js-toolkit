{"version":3,"sources":["../../src/services/scroll.js"],"names":["Scroll","window","pageYOffset","pageXOffset","debounced","trigger","props","handler","bind","document","addEventListener","passive","removeEventListener","yLast","y","xLast","x","changed","last","delta","progress","max","scrollingElement","body","scrollWidth","innerWidth","scrollHeight","innerHeight","Service","scroll","add","remove"],"mappings":"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","sourcesContent":["import Service from '../abstracts/Service';\nimport throttle from '../utils/throttle';\nimport debounce from '../utils/debounce';\nimport nextFrame from '../utils/nextFrame';\n\n/**\n * Scroll service\n *\n * ```\n * import { useScroll } from '@studiometa/js-toolkit/services';\n * const { add, remove, props } = useScroll();\n * add(key, (props) => {});\n * remove(key);\n * props();\n * ```\n */\nclass Scroll extends Service {\n  /** @type {Number} The y scroll position. */\n  y = window.pageYOffset;\n\n  /** @type {Number} The y previous scroll position. */\n  yLast = window.pageYOffset;\n\n  /** @type {Number} The x scroll position. */\n  x = window.pageXOffset;\n\n  /** @type {Number} The x previous scroll position. */\n  xLast = window.pageXOffset;\n\n  /**\n   * Bind the handler to the scroll event.\n   *\n   * @return {void}\n   */\n  init() {\n    const debounced = debounce(() => {\n      this.trigger(this.props);\n      nextFrame(() => {\n        this.trigger(this.props);\n      });\n    }, 50);\n\n    this.handler = throttle(() => {\n      this.trigger(this.props);\n\n      // Reset changed flags at the end of the scroll event\n      debounced();\n    }, 32).bind(this);\n\n    // Fire the `scrolled` method on document scroll\n    document.addEventListener('scroll', this.handler, { passive: true });\n  }\n\n  /**\n   * Unbind the handler from the scroll event.\n   *\n   * @return {void}\n   */\n  kill() {\n    document.removeEventListener('scroll', this.handler);\n  }\n\n  /**\n   * Get scroll props.\n   *\n   * @type {Object}\n   */\n  get props() {\n    this.yLast = this.y;\n    this.xLast = this.x;\n\n    // Check scroll Y\n    if (window.pageYOffset !== this.y) {\n      this.y = window.pageYOffset;\n    }\n\n    // Check scroll x\n    if (window.pageXOffset !== this.x) {\n      this.x = window.pageXOffset;\n    }\n\n    return {\n      x: this.x,\n      y: this.y,\n      changed: {\n        x: this.x !== this.xLast,\n        y: this.y !== this.yLast,\n      },\n      last: {\n        x: this.xLast,\n        y: this.yLast,\n      },\n      delta: {\n        x: this.x - this.xLast,\n        y: this.y - this.yLast,\n      },\n      progress: {\n        x: this.max.x === 0 ? 1 : this.x / this.max.x,\n        y: this.max.y === 0 ? 1 : this.y / this.max.y,\n      },\n      max: this.max,\n    };\n  }\n\n  /**\n   * Get scroll max values.\n   *\n   * @type {Object}\n   */\n  get max() {\n    return {\n      x: (document.scrollingElement || document.body).scrollWidth - window.innerWidth,\n      y: (document.scrollingElement || document.body).scrollHeight - window.innerHeight,\n    };\n  }\n}\n\nlet scroll = null;\n\nexport default () => {\n  if (!scroll) {\n    scroll = new Scroll();\n  }\n\n  const add = scroll.add.bind(scroll);\n  const remove = scroll.remove.bind(scroll);\n  const props = () => scroll.props;\n\n  return {\n    add,\n    remove,\n    props,\n  };\n};\n"],"file":"scroll.js"}