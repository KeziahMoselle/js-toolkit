{"version":3,"sources":["../../src/services/scroll.js"],"names":["Service","throttle","debounce","nextFrame","Scroll","window","pageYOffset","pageXOffset","debounced","trigger","props","handler","bind","document","addEventListener","passive","removeEventListener","yLast","y","xLast","x","changed","last","delta","progress","max","scrollingElement","body","scrollWidth","innerWidth","scrollHeight","innerHeight","scroll","useScroll","add","remove","has"],"mappings":"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","sourcesContent":["import Service from '../abstracts/Service';\nimport throttle from '../utils/throttle';\nimport debounce from '../utils/debounce';\nimport nextFrame from '../utils/nextFrame';\n\n/**\n * @typedef {import('./index').ServiceInterface} ServiceInterface\n */\n\n/**\n * @typedef {Object} ScrollServiceProps\n * @property {Number} x\n * @property {Number} y\n * @property {{ x: Boolean, y: Boolean }} changed\n * @property {{ x: Number, y: Number }} last\n * @property {{ x: Number, y: Number }} delta\n * @property {{ x: Number, y: Number }} progress\n * @property {{ x: Number, y: Number }} max\n */\n\n/**\n * @typedef {Object} ScrollService\n * @property {(key:String, callback:(props:ScrollServiceProps) => void) => void} add\n *   Add a function to the resize service. The key must be uniq.\n * @property {() => ScrollServiceProps} props\n *   Get the current values of the resize service props.\n */\n\n/**\n * Scroll service\n */\nclass Scroll extends Service {\n  /** @type {Number} The y scroll position. */\n  y = window.pageYOffset;\n\n  /** @type {Number} The y previous scroll position. */\n  yLast = window.pageYOffset;\n\n  /** @type {Number} The x scroll position. */\n  x = window.pageXOffset;\n\n  /** @type {Number} The x previous scroll position. */\n  xLast = window.pageXOffset;\n\n  /**\n   * Bind the handler to the scroll event.\n   *\n   * @return {Scroll}\n   */\n  init() {\n    const debounced = debounce(() => {\n      this.trigger(this.props);\n      nextFrame(() => {\n        this.trigger(this.props);\n      });\n    }, 50);\n\n    this.handler = throttle(() => {\n      this.trigger(this.props);\n\n      // Reset changed flags at the end of the scroll event\n      debounced();\n    }, 32).bind(this);\n\n    // Fire the `scrolled` method on document scroll\n    document.addEventListener('scroll', this.handler, { passive: true });\n    return this;\n  }\n\n  /**\n   * Unbind the handler from the scroll event.\n   *\n   * @return {Scroll}\n   */\n  kill() {\n    document.removeEventListener('scroll', this.handler);\n    return this;\n  }\n\n  /**\n   * Get scroll props.\n   *\n   * @type {Object}\n   */\n  get props() {\n    this.yLast = this.y;\n    this.xLast = this.x;\n\n    // Check scroll Y\n    if (window.pageYOffset !== this.y) {\n      this.y = window.pageYOffset;\n    }\n\n    // Check scroll x\n    if (window.pageXOffset !== this.x) {\n      this.x = window.pageXOffset;\n    }\n\n    return {\n      x: this.x,\n      y: this.y,\n      changed: {\n        x: this.x !== this.xLast,\n        y: this.y !== this.yLast,\n      },\n      last: {\n        x: this.xLast,\n        y: this.yLast,\n      },\n      delta: {\n        x: this.x - this.xLast,\n        y: this.y - this.yLast,\n      },\n      progress: {\n        x: this.max.x === 0 ? 1 : this.x / this.max.x,\n        y: this.max.y === 0 ? 1 : this.y / this.max.y,\n      },\n      max: this.max,\n    };\n  }\n\n  /**\n   * Get scroll max values.\n   *\n   * @type {Object}\n   */\n  get max() {\n    return {\n      x: (document.scrollingElement || document.body).scrollWidth - window.innerWidth,\n      y: (document.scrollingElement || document.body).scrollHeight - window.innerHeight,\n    };\n  }\n}\n\nlet scroll = null;\n\n/**\n * Use the scroll service.\n *\n * ```js\n * import { useScroll } from '@studiometa/js-toolkit/services';\n * const { add, remove, props } = useScroll();\n * add(key, (props) => {});\n * remove(key);\n * props();\n * ```\n *\n * @return {ServiceInterface & ScrollService}\n */\nexport default function useScroll() {\n  if (!scroll) {\n    scroll = new Scroll();\n  }\n\n  const add = scroll.add.bind(scroll);\n  const remove = scroll.remove.bind(scroll);\n  const has = scroll.has.bind(scroll);\n  const props = () => scroll.props;\n\n  return {\n    add,\n    remove,\n    has,\n    props,\n  };\n}\n"],"file":"scroll.js"}