{"version":3,"sources":["../../src/services/key.js"],"names":["Service","keyCodes","Key","handler","event","trigger","props","document","addEventListener","passive","removeEventListener","keys","Object","entries","reduce","acc","name","code","keyCode","previousEvent","type","triggered","direction","isUp","isDown","key","useKey","add","bind","remove","has"],"mappings":";;;;;;;;;;;;;;;;;OAAOA,O;OACAC,Q;;IAiCDC,G;;;;;;;;;;;;;;;;4DAEI,E;;gEAMI,C;;oEAGI,E;;;;;;;2BAOT;AAAA;;AACL,WAAKC,OAAL,GAAe,UAACC,KAAD,EAAW;AACxB,QAAA,MAAI,CAACA,KAAL,GAAaA,KAAb;;AACA,QAAA,MAAI,CAACC,OAAL,CAAa,MAAI,CAACC,KAAlB;AACD,OAHD;;AAIAC,MAAAA,QAAQ,CAACC,gBAAT,CAA0B,SAA1B,EAAqC,KAAKL,OAA1C,EAAmD;AAAEM,QAAAA,OAAO,EAAE;AAAX,OAAnD;AACAF,MAAAA,QAAQ,CAACC,gBAAT,CAA0B,OAA1B,EAAmC,KAAKL,OAAxC,EAAiD;AAAEM,QAAAA,OAAO,EAAE;AAAX,OAAjD;AACA,aAAO,IAAP;AACD;;;2BAOM;AACLF,MAAAA,QAAQ,CAACG,mBAAT,CAA6B,SAA7B,EAAwC,KAAKP,OAA7C;AACAI,MAAAA,QAAQ,CAACG,mBAAT,CAA6B,OAA7B,EAAsC,KAAKP,OAA3C;AACA,aAAO,IAAP;AACD;;;wBAOW;AAAA;;AACV,UAAMQ,IAAI,GAAGC,MAAM,CAACC,OAAP,CAAeZ,QAAf,EAAyBa,MAAzB,CAAgC,UAACC,GAAD,QAAuB;AAAA;AAAA,YAAhBC,IAAgB;AAAA,YAAVC,IAAU;;AAClEF,QAAAA,GAAG,CAACC,IAAD,CAAH,GAAYC,IAAI,KAAK,MAAI,CAACb,KAAL,CAAWc,OAAhC;AACA,eAAOH,GAAP;AACD,OAHY,EAGV,EAHU,CAAb;;AAKA,UAAI,CAAC,KAAKI,aAAL,CAAmBC,IAAxB,EAA8B;AAC5B,aAAKC,SAAL,GAAiB,CAAjB;AACD;;AAED,UAAI,KAAKjB,KAAL,CAAWgB,IAAX,KAAoB,SAApB,IAAiC,KAAKD,aAAL,CAAmBC,IAAnB,KAA4B,SAAjE,EAA4E;AAC1E,aAAKC,SAAL,IAAkB,CAAlB;AACD,OAFD,MAEO;AACL,aAAKA,SAAL,GAAiB,CAAjB;AACD;;AAED,WAAKF,aAAL,GAAqB,KAAKf,KAA1B;AAEA;AACEA,QAAAA,KAAK,EAAE,KAAKA,KADd;AAEEiB,QAAAA,SAAS,EAAE,KAAKA,SAFlB;AAGEC,QAAAA,SAAS,EAAE,KAAKlB,KAAL,CAAWgB,IAAX,KAAoB,SAApB,GAAgC,MAAhC,GAAyC,IAHtD;AAIEG,QAAAA,IAAI,EAAE,KAAKnB,KAAL,CAAWgB,IAAX,KAAoB,OAJ5B;AAKEI,QAAAA,MAAM,EAAE,KAAKpB,KAAL,CAAWgB,IAAX,KAAoB;AAL9B,SAMKT,IANL;AAQD;;;;EAtEeX,O;;AAyElB,IAAIyB,GAAG,GAAG,IAAV;AAeA,eAAe,SAASC,MAAT,GAAkB;AAC/B,MAAI,CAACD,GAAL,EAAU;AACRA,IAAAA,GAAG,GAAG,IAAIvB,GAAJ,EAAN;AACD;;AAED,MAAMyB,GAAG,GAAGF,GAAG,CAACE,GAAJ,CAAQC,IAAR,CAAaH,GAAb,CAAZ;AACA,MAAMI,MAAM,GAAGJ,GAAG,CAACI,MAAJ,CAAWD,IAAX,CAAgBH,GAAhB,CAAf;AACA,MAAMK,GAAG,GAAGL,GAAG,CAACK,GAAJ,CAAQF,IAAR,CAAaH,GAAb,CAAZ;;AACA,MAAMnB,KAAK,GAAG,SAARA,KAAQ;AAAA,WAAMmB,GAAG,CAACnB,KAAV;AAAA,GAAd;;AAEA,SAAO;AACLqB,IAAAA,GAAG,EAAHA,GADK;AAELE,IAAAA,MAAM,EAANA,MAFK;AAGLC,IAAAA,GAAG,EAAHA,GAHK;AAILxB,IAAAA,KAAK,EAALA;AAJK,GAAP;AAMD","sourcesContent":["import Service from '../abstracts/Service';\nimport keyCodes from '../utils/keyCodes';\n\n/**\n * @typedef {import('./index').ServiceInterface} ServiceInterface\n */\n\n/**\n * @typedef {Object} KeyServiceProps\n * @property {KeyboardEvent} event\n * @property {Number} triggered\n * @property {Boolean} isUp\n * @property {Boolean} isDown\n * @property {Boolean} ENTER\n * @property {Boolean} SPACE\n * @property {Boolean} TAB\n * @property {Boolean} ESC\n * @property {Boolean} LEFT\n * @property {Boolean} UP\n * @property {Boolean} RIGHT\n * @property {Boolean} DOWN\n */\n\n/**\n * @typedef {Object} KeyService\n * @property {(key:String, callback:(props:KeyServiceProps) => void) => void} add\n *   Add a function to the resize service. The key must be uniq.\n * @property {() => KeyServiceProps} props\n *   Get the current values of the resize service props.\n */\n\n/**\n * Scroll service\n */\nclass Key extends Service {\n  /** @type {Object} The event object. */\n  event = {};\n\n  /**\n   * Used to accumulate the number of times the `keydown` event has been triggered.\n   * @type {Number}\n   */\n  triggered = 0;\n\n  /** @type {Object} The previous event object. */\n  previousEvent = {};\n\n  /**\n   * Bind the handler to the keyboard event.\n   *\n   * @return {Key}\n   */\n  init() {\n    this.handler = (event) => {\n      this.event = event;\n      this.trigger(this.props);\n    };\n    document.addEventListener('keydown', this.handler, { passive: false });\n    document.addEventListener('keyup', this.handler, { passive: false });\n    return this;\n  }\n\n  /**\n   * Unbind the handler from the keyboard event.\n   *\n   * @return {Key}\n   */\n  kill() {\n    document.removeEventListener('keydown', this.handler);\n    document.removeEventListener('keyup', this.handler);\n    return this;\n  }\n\n  /**\n   * Get keyboard props.\n   *\n   * @type {Object}\n   */\n  get props() {\n    const keys = Object.entries(keyCodes).reduce((acc, [name, code]) => {\n      acc[name] = code === this.event.keyCode;\n      return acc;\n    }, {});\n\n    if (!this.previousEvent.type) {\n      this.triggered = 0;\n    }\n\n    if (this.event.type === 'keydown' && this.previousEvent.type === 'keydown') {\n      this.triggered += 1;\n    } else {\n      this.triggered = 1;\n    }\n\n    this.previousEvent = this.event;\n\n    return {\n      event: this.event,\n      triggered: this.triggered,\n      direction: this.event.type === 'keydown' ? 'down' : 'up',\n      isUp: this.event.type === 'keyup',\n      isDown: this.event.type === 'keydown',\n      ...keys,\n    };\n  }\n}\n\nlet key = null;\n\n/**\n * Use the keyboard service.\n *\n * ```js\n * import { useKey } from '@studiometa/js-toolkit/services';\n * const { add, remove, props } = useKey();\n * add(key, (props) => {});\n * remove(key);\n * props();\n * ```\n *\n * @return {ServiceInterface & KeyService}\n */\nexport default function useKey() {\n  if (!key) {\n    key = new Key();\n  }\n\n  const add = key.add.bind(key);\n  const remove = key.remove.bind(key);\n  const has = key.has.bind(key);\n  const props = () => key.props;\n\n  return {\n    add,\n    remove,\n    has,\n    props,\n  };\n}\n"],"file":"key.js"}