{"version":3,"sources":["../../src/services/raf.js"],"names":["Service","getRaf","Raf","raf","loop","trigger","props","isTicking","time","window","performance","now","instance","useRaf","add","bind","remove","has"],"mappings":";;;;;;;;;;;;AAAA,OAAOA,OAAP,MAAoB,sBAApB;AACA,SAASC,MAAT,QAAuB,oBAAvB;;IAsBMC,G;;;;;;;;;;;;;;;;gEAEQ,K;;;;;;;2BAOL;AAAA;;AACL,UAAMC,GAAG,GAAGF,MAAM,EAAlB;;AAEA,UAAMG,IAAI,GAAG,SAAPA,IAAO,GAAM;AACjB,QAAA,MAAI,CAACC,OAAL,CAAa,MAAI,CAACC,KAAlB;;AAEA,YAAI,CAAC,MAAI,CAACC,SAAV,EAAqB;AACnB;AACD;;AAEDJ,QAAAA,GAAG,CAACC,IAAD,CAAH;AACD,OARD;;AAUA,WAAKG,SAAL,GAAiB,IAAjB;AACAH,MAAAA,IAAI;AACJ,aAAO,IAAP;AACD;;;2BAOM;AACL,WAAKG,SAAL,GAAiB,KAAjB;AACA,aAAO,IAAP;AACD;;;wBAQW;AACV,aAAO;AACLC,QAAAA,IAAI,EAAEC,MAAM,CAACC,WAAP,CAAmBC,GAAnB;AADD,OAAP;AAGD;;;;EA/CeX,O;;AAkDlB,IAAIY,QAAQ,GAAG,IAAf;AAeA,eAAe,SAASC,MAAT,GAAkB;AAC/B,MAAI,CAACD,QAAL,EAAe;AACbA,IAAAA,QAAQ,GAAG,IAAIV,GAAJ,EAAX;AACD;;AAED,MAAMY,GAAG,GAAGF,QAAQ,CAACE,GAAT,CAAaC,IAAb,CAAkBH,QAAlB,CAAZ;AACA,MAAMI,MAAM,GAAGJ,QAAQ,CAACI,MAAT,CAAgBD,IAAhB,CAAqBH,QAArB,CAAf;AACA,MAAMK,GAAG,GAAGL,QAAQ,CAACK,GAAT,CAAaF,IAAb,CAAkBH,QAAlB,CAAZ;;AACA,MAAMN,KAAK,GAAG,SAARA,KAAQ;AAAA,WAAMM,QAAQ,CAACN,KAAf;AAAA,GAAd;;AAEA,SAAO;AACLQ,IAAAA,GAAG,EAAHA,GADK;AAELE,IAAAA,MAAM,EAANA,MAFK;AAGLC,IAAAA,GAAG,EAAHA,GAHK;AAILX,IAAAA,KAAK,EAALA;AAJK,GAAP;AAMD","sourcesContent":["import Service from '../abstracts/Service';\nimport { getRaf } from '../utils/nextFrame';\n\n/**\n * @typedef {import('./index').ServiceInterface} ServiceInterface\n */\n\n/**\n * @typedef {Object} RafServiceProps\n * @property {DOMHighResTimeStamp} time\n */\n\n/**\n * @typedef {Object} RafService\n * @property {(key:String, callback:(props:RafServiceProps) => void) => void} add\n *   Add a function to the resize service. The key must be uniq.\n * @property {() => RafServiceProps} props\n *   Get the current values of the resize service props.\n */\n\n/**\n * Tick service\n */\nclass Raf extends Service {\n  /** @type {Boolean} Whether the loop is running or not. */\n  isTicking = false;\n\n  /**\n   * Start the requestAnimationFrame loop.\n   *\n   * @return {Raf}\n   */\n  init() {\n    const raf = getRaf();\n\n    const loop = () => {\n      this.trigger(this.props);\n\n      if (!this.isTicking) {\n        return;\n      }\n\n      raf(loop);\n    };\n\n    this.isTicking = true;\n    loop();\n    return this;\n  }\n\n  /**\n   * Stop the requestAnimationFrame loop.\n   *\n   * @return {Raf}\n   */\n  kill() {\n    this.isTicking = false;\n    return this;\n  }\n\n  /**\n   * Get raf props.\n   *\n   * @todo Return elapsed time / index?\n   * @type {Object}\n   */\n  get props() {\n    return {\n      time: window.performance.now(),\n    };\n  }\n}\n\nlet instance = null;\n\n/**\n * Use the RequestAnimationFrame (raf) service.\n *\n * ```js\n * import { useRaf } from '@studiometa/js/services';\n * const { add, remove, props } = useRag();\n * add(id, (props) => {});\n * remove(id);\n * props();\n * ```\n *\n * @return {ServiceInterface & RafService}\n */\nexport default function useRaf() {\n  if (!instance) {\n    instance = new Raf();\n  }\n\n  const add = instance.add.bind(instance);\n  const remove = instance.remove.bind(instance);\n  const has = instance.has.bind(instance);\n  const props = () => instance.props;\n\n  return {\n    add,\n    remove,\n    has,\n    props,\n  };\n}\n"],"file":"raf.js"}