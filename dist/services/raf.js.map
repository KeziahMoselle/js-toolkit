{"version":3,"sources":["../../src/services/raf.js"],"names":["Raf","raf","loop","trigger","props","isTicking","time","window","performance","now","Service","instance","add","bind","remove"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;;;;;AAEA;;;;;;;;;;;IAWMA,G;;;;;;;;;;;;;;;4FAEQ,K;;;;;;;AAEZ;;;;;2BAKO;AAAA;;AACL,UAAMC,GAAG,GAAG,wBAAZ;;AAEA,UAAMC,IAAI,GAAG,SAAPA,IAAO,GAAM;AACjB,QAAA,MAAI,CAACC,OAAL,CAAa,MAAI,CAACC,KAAlB;;AAEA,YAAI,CAAC,MAAI,CAACC,SAAV,EAAqB;AACnB;AACD;;AAEDJ,QAAAA,GAAG,CAACC,IAAD,CAAH;AACD,OARD;;AAUA,WAAKG,SAAL,GAAiB,IAAjB;AACAH,MAAAA,IAAI;AACL;AAED;;;;;;;;2BAKO;AACL,WAAKG,SAAL,GAAiB,KAAjB;AACD;AAED;;;;;;;;;wBAMY;AACV,aAAO;AACLC,QAAAA,IAAI,EAAEC,MAAM,CAACC,WAAP,CAAmBC,GAAnB;AADD,OAAP;AAGD;;;EA7CeC,iB;;AAgDlB,IAAIC,QAAQ,GAAG,IAAf;;eAEe,oBAAM;AACnB,MAAI,CAACA,QAAL,EAAe;AACbA,IAAAA,QAAQ,GAAG,IAAIX,GAAJ,EAAX;AACD;;AAED,MAAMY,GAAG,GAAGD,QAAQ,CAACC,GAAT,CAAaC,IAAb,CAAkBF,QAAlB,CAAZ;AACA,MAAMG,MAAM,GAAGH,QAAQ,CAACG,MAAT,CAAgBD,IAAhB,CAAqBF,QAArB,CAAf;;AACA,MAAMP,KAAK,GAAG,SAARA,KAAQ;AAAA,WAAMO,QAAQ,CAACP,KAAf;AAAA,GAAd;;AAEA,SAAO;AACLQ,IAAAA,GAAG,EAAHA,GADK;AAELE,IAAAA,MAAM,EAANA,MAFK;AAGLV,IAAAA,KAAK,EAALA;AAHK,GAAP;AAKD,C","sourcesContent":["import Service from '../abstracts/Service';\nimport { getRaf } from '../utils/nextFrame';\n\n/**\n * Tick service\n *\n * ```\n * import { useRaf } from '@studiometa/js/services';\n * const { add, remove, props } = useRag();\n * add(id, (props) => {});\n * remove(id);\n * props();\n * ```\n */\nclass Raf extends Service {\n  /** @type {Boolean} Whether the loop is running or not. */\n  isTicking = false;\n\n  /**\n   * Start the requestAnimationFrame loop.\n   *\n   * @return {void}\n   */\n  init() {\n    const raf = getRaf();\n\n    const loop = () => {\n      this.trigger(this.props);\n\n      if (!this.isTicking) {\n        return;\n      }\n\n      raf(loop);\n    };\n\n    this.isTicking = true;\n    loop();\n  }\n\n  /**\n   * Stop the requestAnimationFrame loop.\n   *\n   * @return {void}\n   */\n  kill() {\n    this.isTicking = false;\n  }\n\n  /**\n   * Get raf props.\n   *\n   * @todo Return elapsed time / index?\n   * @type {Object}\n   */\n  get props() {\n    return {\n      time: window.performance.now(),\n    };\n  }\n}\n\nlet instance = null;\n\nexport default () => {\n  if (!instance) {\n    instance = new Raf();\n  }\n\n  const add = instance.add.bind(instance);\n  const remove = instance.remove.bind(instance);\n  const props = () => instance.props;\n\n  return {\n    add,\n    remove,\n    props,\n  };\n};\n"],"file":"raf.js"}