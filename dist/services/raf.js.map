{"version":3,"sources":["../../src/services/raf.js"],"names":["Service","getRaf","Raf","raf","loop","trigger","props","isTicking","time","window","performance","now","instance","add","bind","remove","has"],"mappings":";;;;;;;;;;;;AAAA,OAAOA,OAAP,MAAoB,sBAApB;AACA,SAASC,MAAT,QAAuB,oBAAvB;;IAaMC,G;;;;;;;;;;;;;;;;gEAEQ,K;;;;;;;2BAOL;AAAA;;AACL,UAAMC,GAAG,GAAGF,MAAM,EAAlB;;AAEA,UAAMG,IAAI,GAAG,SAAPA,IAAO,GAAM;AACjB,QAAA,MAAI,CAACC,OAAL,CAAa,MAAI,CAACC,KAAlB;;AAEA,YAAI,CAAC,MAAI,CAACC,SAAV,EAAqB;AACnB;AACD;;AAEDJ,QAAAA,GAAG,CAACC,IAAD,CAAH;AACD,OARD;;AAUA,WAAKG,SAAL,GAAiB,IAAjB;AACAH,MAAAA,IAAI;AACJ,aAAO,IAAP;AACD;;;2BAOM;AACL,WAAKG,SAAL,GAAiB,KAAjB;AACA,aAAO,IAAP;AACD;;;wBAQW;AACV,aAAO;AACLC,QAAAA,IAAI,EAAEC,MAAM,CAACC,WAAP,CAAmBC,GAAnB;AADD,OAAP;AAGD;;;;EA/CeX,O;;AAkDlB,IAAIY,QAAQ,GAAG,IAAf;AAEA,gBAAe,YAAM;AACnB,MAAI,CAACA,QAAL,EAAe;AACbA,IAAAA,QAAQ,GAAG,IAAIV,GAAJ,EAAX;AACD;;AAED,MAAMW,GAAG,GAAGD,QAAQ,CAACC,GAAT,CAAaC,IAAb,CAAkBF,QAAlB,CAAZ;AACA,MAAMG,MAAM,GAAGH,QAAQ,CAACG,MAAT,CAAgBD,IAAhB,CAAqBF,QAArB,CAAf;AACA,MAAMI,GAAG,GAAGJ,QAAQ,CAACI,GAAT,CAAaF,IAAb,CAAkBF,QAAlB,CAAZ;;AACA,MAAMN,KAAK,GAAG,SAARA,KAAQ;AAAA,WAAMM,QAAQ,CAACN,KAAf;AAAA,GAAd;;AAEA,SAAO;AACLO,IAAAA,GAAG,EAAHA,GADK;AAELE,IAAAA,MAAM,EAANA,MAFK;AAGLC,IAAAA,GAAG,EAAHA,GAHK;AAILV,IAAAA,KAAK,EAALA;AAJK,GAAP;AAMD,CAhBD","sourcesContent":["import Service from '../abstracts/Service';\nimport { getRaf } from '../utils/nextFrame';\n\n/**\n * Tick service\n *\n * ```\n * import { useRaf } from '@studiometa/js/services';\n * const { add, remove, props } = useRag();\n * add(id, (props) => {});\n * remove(id);\n * props();\n * ```\n */\nclass Raf extends Service {\n  /** @type {Boolean} Whether the loop is running or not. */\n  isTicking = false;\n\n  /**\n   * Start the requestAnimationFrame loop.\n   *\n   * @return {Raf}\n   */\n  init() {\n    const raf = getRaf();\n\n    const loop = () => {\n      this.trigger(this.props);\n\n      if (!this.isTicking) {\n        return;\n      }\n\n      raf(loop);\n    };\n\n    this.isTicking = true;\n    loop();\n    return this;\n  }\n\n  /**\n   * Stop the requestAnimationFrame loop.\n   *\n   * @return {Raf}\n   */\n  kill() {\n    this.isTicking = false;\n    return this;\n  }\n\n  /**\n   * Get raf props.\n   *\n   * @todo Return elapsed time / index?\n   * @type {Object}\n   */\n  get props() {\n    return {\n      time: window.performance.now(),\n    };\n  }\n}\n\nlet instance = null;\n\nexport default () => {\n  if (!instance) {\n    instance = new Raf();\n  }\n\n  const add = instance.add.bind(instance);\n  const remove = instance.remove.bind(instance);\n  const has = instance.has.bind(instance);\n  const props = () => instance.props;\n\n  return {\n    add,\n    remove,\n    has,\n    props,\n  };\n};\n"],"file":"raf.js"}