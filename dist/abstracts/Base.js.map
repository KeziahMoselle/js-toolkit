{"version":3,"sources":["../../src/abstracts/Base.js"],"names":["debug","instance","args","$options","window","console","log","apply","config","name","getRefs","element","elements","Array","from","querySelectorAll","length","reduce","$refs","$ref","refName","dataset","ref","replace","isArray","push","getChildren","components","Object","entries","acc","ComponentClass","prototype","selector","el","map","options","call","method","$isMounted","$emit","mountComponents","$children","values","forEach","$child","c","$mount","destroyComponents","destroy","Base","Error","$id","$el","document","querySelector","JSON","parse","err","addEventListener","event","add","$on","requestAnimationFrame","EventManager"],"mappings":"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","sourcesContent":["import nanoid from 'nanoid';\nimport EventManager from './EventManager';\nimport { useScroll, useResize, useRaf, usePointer } from '../services';\nimport { hasMethod } from '../utils';\n\n/**\n * Verbose debug for the component.\n * @param  {...any} args The arguments passed to the method\n * @return {void}\n */\nfunction debug(instance, ...args) {\n  return instance.$options.debug\n    ? window.console.log.apply(window, [instance.config.name, ...args])\n    : () => {};\n}\n\n/**\n * Get all refs of a component.\n *\n * @param {HTMLElement}  element The component's root element\n * @param {String}       name    The component's name\n * @return {null|Object}         Returns `null` if no refs were found or an object of references\n */\nfunction getRefs(element, name) {\n  const elements = Array.from(element.querySelectorAll(`[data-ref^=\"${name}.\"]`));\n\n  if (elements.length === 0) {\n    return null;\n  }\n\n  return elements.reduce(($refs, $ref) => {\n    const refName = $ref.dataset.ref.replace(`${name}.`, '');\n    if ($refs[refName]) {\n      if (Array.isArray($refs[refName])) {\n        $refs[refName].push($ref);\n      } else {\n        $refs[refName] = [$refs[refName], $ref];\n      }\n    } else {\n      $refs[refName] = $ref;\n    }\n\n    return $refs;\n  }, {});\n}\n\n/**\n *\n * @param  {HTMLElement} element    The component's root element\n * @param  {Object}      components The children components' classes\n * @return {null|Object}            Returns `null` if no child components are defined or an object of all child component instances\n */\nfunction getChildren(element, components) {\n  if (!components) {\n    return null;\n  }\n\n  return Object.entries(components).reduce((acc, [name, ComponentClass]) => {\n    const { config } = ComponentClass.prototype || {};\n    const selector = config.el || `[data-component=\"${name}\"]`;\n    const elements = Array.from(element.querySelectorAll(selector));\n\n    if (elements.length === 0) {\n      return acc;\n    }\n\n    acc[name] = elements.map(el => {\n      const { options } = el.dataset;\n      return new ComponentClass(el, options);\n    });\n\n    return acc;\n  }, {});\n}\n\n/**\n * Call the given method while applying the given arguments.\n *\n * @param {String} method The method to call\n * @param {...any} args   The arguments to pass to the method\n */\nfunction call(instance, method, ...args) {\n  debug(instance, 'call', method, ...args);\n\n  if (!hasMethod(instance, method)) {\n    return instance;\n  }\n\n  // Prevent duplicate call of `created` and `destroyed`\n  // methods based on the component status\n  if (\n    (method === 'destroyed' && !instance.$isMounted) ||\n    (method === 'created' && instance.$isMounted)\n  ) {\n    return instance;\n  }\n\n  instance.$emit(method, ...args);\n  instance[method].call(instance, ...args);\n  debug(instance, method, instance, ...args);\n\n  return instance;\n}\n\n/**\n * Tie the components' `created` method to the instance\n */\nfunction mountComponents(instance) {\n  if (!instance.$children) {\n    return;\n  }\n  debug(instance, 'mountComponents', instance.$children);\n\n  Object.values(instance.$children).forEach($child => {\n    if (Array.isArray($child)) {\n      $child.forEach(c => {\n        c.$mount();\n      });\n    } else {\n      $child.$mount();\n    }\n  });\n}\n\n/**\n * Tie the components' `destroyed` method to the instance.\n *\n * @param  {Base} instance The base instance.\n * @return {void}\n */\nfunction destroyComponents(instance) {\n  if (!instance.$children) {\n    return;\n  }\n  debug(instance, 'destroyComponents', instance.$children);\n\n  Object.values(instance.$children).forEach($child => {\n    $child.destroy();\n  });\n}\n\n/**\n * Page lifecycle class\n *\n * @method created   Fired when the class is instantiated\n * @method loaded    Fired on the window's load event\n * @method ticked    Fired each frame with `requestAnimationFrame`\n * @method resized   Fired when the window is resized (`resize` event)\n * @method moved     Fired when the pointer has moved (`touchmove` and `mousemove` events)\n * @method scrolled  Fired with debounce when the document is scrolled (`scroll` event)\n * @method destroyed Fired when the window is being unloaded (`unload` event)\n */\nexport default class Base extends EventManager {\n  /**\n   * Class constructor where all the magic takes place\n   * @param  {Object}    options An option object\n   * @return {Base}         The created instance\n   */\n  constructor(element) {\n    super();\n\n    if (!this.config) {\n      throw new Error('The `config` getter must be defined.');\n    }\n\n    if (!this.config.name) {\n      throw new Error('The `config.name` property is required.');\n    }\n\n    this.$isMounted = false;\n    this.$id = `${this.config.name}-${nanoid()}`;\n    this.$el = element || document.querySelector(this.config.el);\n\n    if (!this.$el) {\n      throw new Error('Unable to find the root element.');\n    }\n\n    let options = {};\n    if (this.$el.dataset.options) {\n      try {\n        options = JSON.parse(this.$el.dataset.options);\n      } catch (err) {\n        throw new Error('Can not parse the `data-options` attribute. Is it a valid JSON string?');\n      }\n    }\n\n    this.$options = { ...this.config, ...(options || {}) };\n\n    debug(this, 'constructor', this);\n\n    const $refs = getRefs(this.$el, this.config.name);\n    if ($refs) {\n      this.$refs = $refs;\n    }\n\n    const $children = getChildren(this.$el, this.config.components);\n    if ($children) {\n      this.$children = $children;\n    }\n\n    // Fire the `loaded` method on window load\n    if (hasMethod(this, 'loaded')) {\n      window.addEventListener('load', event => {\n        call(this, 'loaded', { event });\n      });\n    }\n\n    // Fire the `scrolled` method on window/document scroll\n    if (hasMethod(this, 'scrolled')) {\n      const { add } = useScroll();\n      add(this.$id, (...args) => {\n        call(this, 'scrolled', ...args);\n      });\n    }\n\n    // Fire the `resized` method on window resize\n    if (hasMethod(this, 'resized')) {\n      const { add } = useResize();\n      add(this.$id, (...args) => {\n        call(this, 'resized', ...args);\n      });\n    }\n\n    // Fire the `ticked` method on each frame\n    if (hasMethod(this, 'ticked')) {\n      const { add } = useRaf();\n      add(this.$id, (...args) => {\n        call(this, 'ticked', ...args);\n      });\n    }\n\n    // Fire the `ticked` method on each frame\n    if (hasMethod(this, 'moved')) {\n      const { add } = usePointer();\n      add(this.$id, (...args) => {\n        call(this, 'moved', ...args);\n      });\n    }\n\n    // Fire the `destroyed` method on window unload\n    if (hasMethod(this, 'destroyed')) {\n      window.addEventListener('beforeunload', () => {\n        call(this, 'destroyed', this.options);\n      });\n    }\n\n    this.$on('created', () => {\n      mountComponents(this);\n      this.$isMounted = true;\n    });\n\n    // Fire the `created` method on the next frame so the class\n    // properties are correctly loaded\n    requestAnimationFrame(() => {\n      this.$mount();\n    });\n\n    this.$on('destroyed', () => {\n      this.$isMounted = false;\n      destroyComponents(this);\n    });\n\n    return this;\n  }\n\n  /**\n   * Small helper to log stuff.\n   *\n   * @param  {...any} args The arguments passed to the method\n   * @return {void}\n   */\n  $log(...args) {\n    return this.$options.log\n      ? window.console.log.apply(window, [this.config.name, ...args])\n      : () => {};\n  }\n\n  /**\n   * Trigger the `created` callback.\n   */\n  $mount() {\n    debug(this, '$mount');\n    call(this, 'mounted');\n  }\n\n  /**\n   * Trigger the `destroyed` callback.\n   */\n  $destroy() {\n    debug(this, '$destroy');\n    call(this, 'destroyed');\n  }\n}\n"],"file":"Base.js"}