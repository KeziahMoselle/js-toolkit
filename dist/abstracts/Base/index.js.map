{"version":3,"sources":["../../../src/abstracts/Base/index.js"],"names":["nanoid","autoBind","EventManager","callMethod","debug","getConfig","getChildren","getComponentElements","getOptions","getRefs","mountComponents","destroyComponents","bindServices","bindEvents","Base","$el","element","Error","name","$id","$options","$children","components","Object","defineProperty","get","configurable","exclude","_excludeFromAutoBind","unbindMethods","$on","$isMounted","forEach","method","$destroy","value","writable","log","window","console","bind","noop","nameOrSelector","map","el","$mount"],"mappings":";;;;;;;;;;;;;AAAA,OAAOA,MAAP,MAAmB,mBAAnB;OACOC,Q;OACAC,Y;SACEC,U,EAAYC,K,EAAOC,S;SAEnBC,W,EAAaC,oB;SACbC,U;SACAC,O;SACAC,e,EAAiBC,iB;OACnBC,Y;OAEAC,U;;IAkDcC,I;;;;;;;wBAuBQ;AACzB,aAAO,CACL,QADK,EAEL,SAFK,EAGL,UAHK,EAIL,YAJK,EAKL,MALK,EAML,KANK,EAOL,OAPK,EAQL,MARK,EASL,OATK,EAUL,SAVK,EAWL,QAXK,EAYL,QAZK,EAaL,SAbK,EAcL,OAdK,EAeL,OAfK,EAgBL,UAhBK,EAiBL,WAjBK,EAkBL,YAlBK,CAAP;AAoBD;;;wBAMY;AACX,aAAO,IAAP;AACD;;;wBASW;AACV,aAAOL,OAAO,CAAC,IAAD,EAAO,KAAKM,GAAZ,CAAd;AACD;;;AAOD,gBAAYC,OAAZ,EAAqB;AAAA;;AAAA;;AACnB;;AADmB,8DAjEX,IAiEW;;AAAA,iEA3DR,KA2DQ;;AAGnB,QAAI,CAACA,OAAL,EAAc;AACZ,YAAM,IAAIC,KAAJ,CAAU,mCAAV,CAAN;AACD;;AALkB,qBAOFZ,SAAS,+BAPP;AAAA,QAOXa,IAPW,cAOXA,IAPW;;AAUnB,UAAKC,GAAL,aAAcD,IAAd,cAAsBlB,MAAM,EAA5B;AAGA,UAAKe,GAAL,GAAWC,OAAX;AAGA,UAAKI,QAAL,GAAgBZ,UAAU,gCAAOQ,OAAP,EAAgBX,SAAS,+BAAzB,CAA1B;AAGA,UAAKgB,SAAL,GAAiBf,WAAW,gCAAO,MAAKS,GAAZ,EAAiBV,SAAS,+BAAT,CAAgBiB,UAAhB,IAA8B,EAA/C,CAA5B;;AAEA,QAAI,EAAE,cAAc,MAAKP,GAArB,CAAJ,EAA+B;AAC7BQ,MAAAA,MAAM,CAACC,cAAP,CAAsB,MAAKT,GAA3B,EAAgC,UAAhC,EAA4C;AAC1CU,QAAAA,GAAG,EAAE;AAAA;AAAA,SADqC;AAE1CC,QAAAA,YAAY,EAAE;AAF4B,OAA5C;AAID;;AAGDzB,IAAAA,QAAQ,gCAAO;AACb0B,MAAAA,OAAO,qBAAM,MAAKC,oBAAX;AADM,KAAP,CAAR;AAIA,QAAIC,aAAa,GAAG,EAApB;;AACA,UAAKC,GAAL,CAAS,SAAT,EAAoB,YAAM;AACxBD,MAAAA,aAAa,gCAAOjB,YAAY,+BAAnB,sBAA8BC,UAAU,+BAAxC,EAAb;AACAH,MAAAA,eAAe,+BAAf;AACA,YAAKqB,UAAL,GAAkB,IAAlB;AACD,KAJD;;AAMA,UAAKD,GAAL,CAAS,SAAT,EAAoB,YAAM;AACxBD,MAAAA,aAAa,CAACG,OAAd,CAAsB,UAACC,MAAD;AAAA,eAAYA,MAAM,EAAlB;AAAA,OAAtB;AACAJ,MAAAA,aAAa,gCAAOjB,YAAY,+BAAnB,sBAA8BC,UAAU,+BAAxC,EAAb;AACAH,MAAAA,eAAe,+BAAf;AACD,KAJD;;AAMA,UAAKoB,GAAL,CAAS,WAAT,EAAsB,YAAM;AAC1B,YAAKC,UAAL,GAAkB,KAAlB;AACAF,MAAAA,aAAa,CAACG,OAAd,CAAsB,UAACC,MAAD;AAAA,eAAYA,MAAM,EAAlB;AAAA,OAAtB;AACAtB,MAAAA,iBAAiB,+BAAjB;AACD,KAJD;;AAMAP,IAAAA,KAAK,gCAAO,aAAP,gCAAL;AACA;AACD;;;;6BAgBQ;AACPA,MAAAA,KAAK,CAAC,IAAD,EAAO,QAAP,CAAL;AACAD,MAAAA,UAAU,CAAC,IAAD,EAAO,SAAP,CAAV;AACA,aAAO,IAAP;AACD;;;8BAKS;AACRC,MAAAA,KAAK,CAAC,IAAD,EAAO,SAAP,CAAL;AACAD,MAAAA,UAAU,CAAC,IAAD,EAAO,SAAP,CAAV;AACA,aAAO,IAAP;AACD;;;+BAKU;AACTC,MAAAA,KAAK,CAAC,IAAD,EAAO,UAAP,CAAL;AACAD,MAAAA,UAAU,CAAC,IAAD,EAAO,WAAP,CAAV;AACA,aAAO,IAAP;AACD;;;iCAMY;AACXC,MAAAA,KAAK,CAAC,IAAD,EAAO,YAAP,CAAL;AAGA,WAAK8B,QAAL;AAGA/B,MAAAA,UAAU,CAAC,IAAD,EAAO,YAAP,CAAV;AAOAoB,MAAAA,MAAM,CAACC,cAAP,CAAsB,KAAKT,GAA3B,EAAgC,UAAhC,EAA4C;AAC1CoB,QAAAA,KAAK,EAAE,YADmC;AAE1CT,QAAAA,YAAY,EAAE,KAF4B;AAG1CU,QAAAA,QAAQ,EAAE;AAHgC,OAA5C;AAKD;;;wBAxDU;AACT,aAAO,KAAKhB,QAAL,CAAciB,GAAd,GACHC,MAAM,CAACC,OAAP,CAAeF,GAAf,CAAmBG,IAAnB,CAAwBF,MAAxB,aAAoC,KAAKlB,QAAL,CAAcF,IAAlD,OADG,GAEH,SAASuB,IAAT,GAAgB,CAAE,CAFtB;AAGD;;;6BA4DeC,c,EAAgB;AAAA;;AAC9B,UAAI,CAACA,cAAL,EAAqB;AACnB,cAAM,IAAIzB,KAAJ,CACJ,8EADI,CAAN;AAGD;;AAED,aAAOV,oBAAoB,CAACmC,cAAD,CAApB,CAAqCC,GAArC,CAAyC,UAACC,EAAD;AAAA,eAAQ,IAAI,MAAJ,CAASA,EAAT,EAAaC,MAAb,EAAR;AAAA,OAAzC,CAAP;AACD;;;;EA3M+B3C,Y;;gBAAbY,I,aAiBF,I;;gBAjBEA,I;;SAAAA,I","sourcesContent":["import nanoid from 'nanoid/non-secure';\nimport autoBind from '../../utils/object/autoBind';\nimport EventManager from '../EventManager';\nimport { callMethod, debug, getConfig } from './utils';\n// eslint-disable-next-line import/no-cycle\nimport { getChildren, getComponentElements } from './children';\nimport { getOptions } from './options';\nimport { getRefs } from './refs';\nimport { mountComponents, destroyComponents } from './components';\nimport bindServices from './services';\n// eslint-disable-next-line import/no-cycle\nimport bindEvents from './events';\n\n/**\n * @typedef {typeof Base} BaseComponent\n * @typedef {() => Promise<BaseComponent | { default: BaseComponent }>} BaseAsyncComponent\n * @typedef {{ name: string, debug: boolean, log: boolean, [name:string]: any }} BaseOptions\n * @typedef {{ [name:string]: HTMLElement | BaseComponent | Array<HTMLElement|BaseComponent> }} BaseRefs\n * @typedef {{ [nameOrSelector:string]: Array<Base | Promise<Base>> }} BaseChildren\n * @typedef {{ [nameOrSelector:string]: BaseComponent | BaseAsyncComponent }} BaseConfigComponents\n * @typedef {import('./classes/Options').OptionsSchema} BaseConfigOptions\n */\n\n/**\n * @typedef {Object} BaseConfig\n * @property {String} name\n * @property {Boolean} [debug]\n * @property {Boolean} [log]\n * @property {String[]} [refs]\n * @property {BaseConfigComponents} [components]\n * @property {BaseConfigOptions} [options]\n */\n\n/**\n * Base class to easily create components.\n *\n * @example\n * ```js\n * class Component extends Base {\n *   static config = {\n *     name: 'Component',\n *     log: true,\n *   };\n *\n *   mounted() {\n *     this.$log('Component is mounted!');\n *   }\n * }\n *\n * class App extends Base {\n *   static config = {\n *     name: 'App',\n *     components: {\n *       Component,\n *     },\n *   };\n * }\n *\n * new App(document.body).$mount();\n * ```\n */\nexport default class Base extends EventManager {\n  /**\n   * The instance parent.\n   * @type {Base}\n   */\n  $parent = null;\n\n  /**\n   * The state of the component.\n   * @type {Boolean}\n   */\n  $isMounted = false;\n\n  /**\n   * This is a Base instance.\n   * @type {Boolean}\n   */\n  static $isBase = true;\n\n  /**\n   * Get properties to exclude from the autobind call.\n   * @return {Array<String|RegExp>}\n   */\n  get _excludeFromAutoBind() {\n    return [\n      '$mount',\n      '$update',\n      '$destroy',\n      '$terminate',\n      '$log',\n      '$on',\n      '$once',\n      '$off',\n      '$emit',\n      'mounted',\n      'loaded',\n      'ticked',\n      'resized',\n      'moved',\n      'keyed',\n      'scrolled',\n      'destroyed',\n      'terminated',\n    ];\n  }\n\n  /**\n   * @deprecated Use the static `config` property instead.\n   * @return {BaseConfig}\n   */\n  get config() {\n    return null;\n  }\n\n  /** @type {BaseConfig} */\n  static config;\n\n  /**\n   * Get the component's refs.\n   * @return {BaseRefs}\n   */\n  get $refs() {\n    return getRefs(this, this.$el);\n  }\n\n  /**\n   * Class constructor where all the magic takes place.\n   *\n   * @param {HTMLElement} element The component's root element dd.\n   */\n  constructor(element) {\n    super();\n\n    if (!element) {\n      throw new Error('The root element must be defined.');\n    }\n\n    const { name } = getConfig(this);\n\n    /** @type {String} */\n    this.$id = `${name}-${nanoid()}`;\n\n    /** @type {HTMLElement} */\n    this.$el = element;\n\n    /** @type {BaseOptions} */\n    this.$options = getOptions(this, element, getConfig(this));\n\n    /** @type {BaseChildren} */\n    this.$children = getChildren(this, this.$el, getConfig(this).components || {});\n\n    if (!('__base__' in this.$el)) {\n      Object.defineProperty(this.$el, '__base__', {\n        get: () => this,\n        configurable: true,\n      });\n    }\n\n    // Autobind all methods to the instance\n    autoBind(this, {\n      exclude: [...this._excludeFromAutoBind],\n    });\n\n    let unbindMethods = [];\n    this.$on('mounted', () => {\n      unbindMethods = [...bindServices(this), ...bindEvents(this)];\n      mountComponents(this);\n      this.$isMounted = true;\n    });\n\n    this.$on('updated', () => {\n      unbindMethods.forEach((method) => method());\n      unbindMethods = [...bindServices(this), ...bindEvents(this)];\n      mountComponents(this);\n    });\n\n    this.$on('destroyed', () => {\n      this.$isMounted = false;\n      unbindMethods.forEach((method) => method());\n      destroyComponents(this);\n    });\n\n    debug(this, 'constructor', this);\n    return this;\n  }\n\n  /**\n   * Small helper to log stuff.\n   *\n   * @return {(...args: any) => void} A log function if the log options is active.\n   */\n  get $log() {\n    return this.$options.log\n      ? window.console.log.bind(window, `[${this.$options.name}]`)\n      : function noop() {};\n  }\n\n  /**\n   * Trigger the `mounted` callback.\n   */\n  $mount() {\n    debug(this, '$mount');\n    callMethod(this, 'mounted');\n    return this;\n  }\n\n  /**\n   * Update the instance children.\n   */\n  $update() {\n    debug(this, '$update');\n    callMethod(this, 'updated');\n    return this;\n  }\n\n  /**\n   * Trigger the `destroyed` callback.\n   */\n  $destroy() {\n    debug(this, '$destroy');\n    callMethod(this, 'destroyed');\n    return this;\n  }\n\n  /**\n   * Terminate a child instance when it is not needed anymore.\n   * @return {void}\n   */\n  $terminate() {\n    debug(this, '$terminate');\n\n    // First, destroy the component.\n    this.$destroy();\n\n    // Execute the `terminated` hook if it exists\n    callMethod(this, 'terminated');\n\n    // Delete the reference to the instance\n    // delete this.$el.__base__;\n\n    // And update its status to prevent re-instantiation when accessing the\n    // parent's `$children` property\n    Object.defineProperty(this.$el, '__base__', {\n      value: 'terminated',\n      configurable: false,\n      writable: false,\n    });\n  }\n\n  /**\n   * Factory method to generate multiple instance of the class.\n   *\n   * @param  {String}      nameOrSelector The selector on which to mount each instance.\n   * @return {Array<Base>}                A list of the created instance.\n   */\n  static $factory(nameOrSelector) {\n    if (!nameOrSelector) {\n      throw new Error(\n        'The $factory method requires a componentâ€™s name or selector to be specified.'\n      );\n    }\n\n    return getComponentElements(nameOrSelector).map((el) => new this(el).$mount());\n  }\n}\n"],"file":"index.js"}