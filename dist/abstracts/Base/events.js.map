{"version":3,"sources":["../../../src/abstracts/Base/events.js"],"names":["Base","getAllProperties","debug","bindRootEvents","instance","eventMethods","map","eventMethod","eventName","replace","toLowerCase","handler","args","$el","addEventListener","removeEventListener","bindRefsEvents","unbindMethods","Object","entries","$refs","forEach","refName","$refOrRefs","Array","isArray","refEventMethod","c","toUpperCase","filter","startsWith","$ref","index","unbindMethod","push","bindChildrenEvents","$children","childName","childEventMethod","$child","$on","bindEvents","ROOT_EVENT_REGEX","REFS_CHILDREN_EVENT_REGEX","reduce","acc","name","test","root","refsOrChildren"],"mappings":"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","sourcesContent":["// eslint-disable-next-line import/no-cycle\nimport Base from './index';\nimport getAllProperties from '../../utils/object/getAllProperties';\nimport { debug } from './utils';\n\n/**\n * Bind event handler methods to the root HTML element.\n *\n * @param  {Base}  instance     A Base instance.\n * @param  {Array} eventMethods A list of methods to bind.\n * @return {Array}              A list of unbind functions.\n */\nfunction bindRootEvents(instance, eventMethods) {\n  return eventMethods.map((eventMethod) => {\n    const eventName = eventMethod.replace(/^on/, '').toLowerCase();\n\n    const handler = (...args) => {\n      debug(instance, eventMethod, instance.$el, ...args);\n      instance[eventMethod](...args);\n    };\n\n    instance.$el.addEventListener(eventName, handler);\n\n    return () => {\n      instance.$el.removeEventListener(eventName, handler);\n    };\n  });\n}\n\n/**\n * Bind event handler methods to refs HTML element.\n *\n * @param  {Base}  instance     A Base instance.\n * @param  {Array} eventMethods A list of methods to bind.\n * @return {Array}              A list of unbind functions.\n */\nfunction bindRefsEvents(instance, eventMethods) {\n  const unbindMethods = [];\n\n  Object.entries(instance.$refs).forEach(([refName, $refOrRefs]) => {\n    const $refs = Array.isArray($refOrRefs) ? $refOrRefs : [$refOrRefs];\n    const refEventMethod = `on${refName.replace(/^\\w/, (c) => c.toUpperCase())}`;\n\n    eventMethods\n      .filter((eventMethod) => eventMethod.startsWith(refEventMethod))\n      .forEach((eventMethod) => {\n        $refs.forEach(($ref, index) => {\n          const eventName = eventMethod.replace(refEventMethod, '').toLowerCase();\n          const handler = (...args) => {\n            debug(instance, eventMethod, $ref, ...args, index);\n            instance[eventMethod](...args, index);\n          };\n\n          debug(instance, 'binding ref event', refName, eventName);\n\n          if ($ref instanceof Base) {\n            // eslint-disable-next-line no-param-reassign\n            $ref = $ref.$el;\n          }\n\n          /** @type {HTMLElement} */ ($ref).addEventListener(eventName, handler);\n          const unbindMethod = () => {\n            debug(instance, 'unbinding ref event', eventMethod);\n            /** @type {HTMLElement} */ ($ref).removeEventListener(eventName, handler);\n          };\n\n          unbindMethods.push(unbindMethod);\n        });\n      });\n  });\n\n  return unbindMethods;\n}\n\n/**\n * Bind event handler methods to children Base instance.\n * @param  {Base}  instance     A Base instance.\n * @param  {Array} eventMethods A list of methods to bind.\n * @return {Array}              A list of unbind functions.\n */\nfunction bindChildrenEvents(instance, eventMethods) {\n  const unbindMethods = [];\n\n  Object.entries(instance.$children).forEach(([childName, $children]) => {\n    const childEventMethod = `on${childName.replace(/^\\w/, (c) => c.toUpperCase())}`;\n\n    eventMethods\n      .filter((eventMethod) => eventMethod.startsWith(childEventMethod))\n      .forEach((eventMethod) => {\n        $children.forEach(\n          /**\n           * @param {Base} $child\n           * @param {Number} index\n           */\n          ($child, index) => {\n            const eventName = eventMethod.replace(childEventMethod, '').toLowerCase();\n            const handler = (...args) => {\n              debug(instance, eventMethod, $child, ...args, index);\n              instance[eventMethod](...args, index);\n            };\n\n            debug(instance, 'binding child event', childName, eventName);\n\n            const unbindMethod = $child.$on(eventName, handler);\n            unbindMethods.push(() => {\n              debug(instance, 'unbinding child event', childName, eventName);\n              unbindMethod();\n            });\n          }\n        );\n      });\n  });\n\n  return unbindMethods;\n}\n\n/**\n * Bind ref and children component's events to their corresponding method.\n *\n * @param  {Base} instance  A Base instance.\n * @return {Array}          A list of methods to unbind the events.\n */\nexport default function bindEvents(instance) {\n  const ROOT_EVENT_REGEX = /^on[A-Z][a-z]+$/;\n  const REFS_CHILDREN_EVENT_REGEX = /^on([A-Z][a-z]+)([A-Z][a-z]+)+$/;\n\n  // Get all event methods\n  const eventMethods = getAllProperties(instance).reduce(\n    (acc, [name]) => {\n      // Testing camelCase with one word: onEvent.\n      if (ROOT_EVENT_REGEX.test(name)) {\n        acc.root.push(name);\n        return acc;\n      }\n\n      // Testing camelCase with more than two words: onRefEvent.\n      if (REFS_CHILDREN_EVENT_REGEX.test(name)) {\n        acc.refsOrChildren.push(name);\n      }\n\n      return acc;\n    },\n    { root: [], refsOrChildren: [] }\n  );\n\n  const unbindMethods = [\n    ...bindRootEvents(instance, eventMethods.root),\n    ...bindRefsEvents(instance, eventMethods.refsOrChildren),\n    ...bindChildrenEvents(instance, eventMethods.refsOrChildren),\n  ];\n\n  return unbindMethods;\n}\n"],"file":"events.js"}