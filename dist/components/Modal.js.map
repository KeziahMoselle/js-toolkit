{"version":3,"sources":["../../src/components/Modal.js"],"names":["trap","untrap","saveActiveElement","Modal","isOpen","close","$options","move","target","document","querySelector","body","refsBackup","$refs","refModalPlaceholder","createComment","refModalParentBackup","modal","parentElement","$el","insertBefore","refModalUnbindGetRefFilter","$on","refs","Object","entries","forEach","key","ref","appendChild","remove","event","isUp","isDown","ESC","Promise","resolve","setAttribute","documentElement","style","overflow","$emit","all","styles","map","refName","open","active","closed","from","to","then","autofocus","focus","name","opacity","pointerEvents","visibility","Base"],"mappings":"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","sourcesContent":["import Base from '../abstracts/Base';\nimport transition from '../utils/css/transition';\nimport focusTrap from '../utils/focusTrap';\n\nconst { trap, untrap, saveActiveElement } = focusTrap();\n\n/**\n * Modal class.\n */\nexport default class Modal extends Base {\n  /**\n   * Modal options.\n   */\n  get config() {\n    return {\n      name: 'Modal',\n      move: false,\n      autofocus: '[autofocus]',\n      styles: {\n        modal: {\n          closed: {\n            opacity: 0,\n            pointerEvents: 'none',\n            visibility: 'hidden',\n          },\n        },\n      },\n    };\n  }\n\n  /**\n   * Open the modal on click on the `open` ref.\n   *\n   * @return {Function} The component's `open` method.\n   */\n  get onOpenClick() {\n    return this.open;\n  }\n\n  /**\n   * Close the modal on click on the `close` ref.\n   *\n   * @return {Function} The component's `close` method.\n   */\n  get onCloseClick() {\n    return this.close;\n  }\n\n  /**\n   * Close the modal on click on the `overlay` ref.\n   *\n   * @return {Function} The component's `close` method.\n   */\n  get onOverlayClick() {\n    return this.close;\n  }\n\n  /**\n   * Initialize the component's behaviours.\n   *\n   * @return {Modal} The current instance.\n   */\n  mounted() {\n    this.isOpen = false;\n    this.close();\n\n    if (this.$options.move) {\n      const target = document.querySelector(this.$options.move) || document.body;\n      const refsBackup = this.$refs;\n\n      this.refModalPlaceholder = document.createComment('');\n      this.refModalParentBackup = this.$refs.modal.parentElement || this.$el;\n      this.refModalParentBackup.insertBefore(this.refModalPlaceholder, this.$refs.modal);\n\n      this.refModalUnbindGetRefFilter = this.$on('get:refs', refs => {\n        Object.entries(refsBackup).forEach(([key, ref]) => {\n          if (!refs[key]) {\n            refs[key] = ref;\n          }\n        });\n      });\n      target.appendChild(this.$refs.modal);\n    }\n\n    return this;\n  }\n\n  /**\n   * Unbind all events on destroy.\n   *\n   * @return {Modal} The Modal instance.\n   */\n  destroyed() {\n    this.close();\n\n    if (this.$options.move) {\n      this.refModalParentBackup.insertBefore(this.$refs.modal, this.refModalPlaceholder);\n      this.refModalUnbindGetRefFilter();\n      this.refModalPlaceholder.remove();\n      delete this.refModalPlaceholder;\n      delete this.refModalParentBackup;\n      delete this.refModalUnbindGetRefFilter;\n    }\n\n    return this;\n  }\n\n  /**\n   * Close the modal on `ESC` and trap the tabulation.\n   *\n   * @param  {KeyboardEvent} options.event  The original keyboard event\n   * @param  {Boolean}       options.isUp   Is it a keyup event?\n   * @param  {Boolean}       options.isDown Is it a keydown event?\n   * @param  {Boolean}       options.ESC    Is it the ESC key?\n   * @return {void}\n   */\n  keyed({ event, isUp, isDown, ESC }) {\n    if (!this.isOpen) {\n      return;\n    }\n\n    if (isDown) {\n      trap(this.$refs.modal, event);\n    }\n\n    if (ESC && isUp) {\n      this.close();\n    }\n  }\n\n  /**\n   * Open the modal.\n   *\n   * @return {Modal} The Modal instance.\n   */\n  async open() {\n    if (this.isOpen) {\n      return Promise.resolve(this);\n    }\n\n    this.$refs.modal.setAttribute('aria-hidden', 'false');\n    document.documentElement.style.overflow = 'hidden';\n\n    this.isOpen = true;\n    this.$emit('open');\n\n    return Promise.all(\n      Object.entries(this.$options.styles).map(([refName, { open, active, closed } = {}]) =>\n        transition(\n          this.$refs[refName],\n          {\n            from: closed,\n            active,\n            to: open,\n          },\n          'keep'\n        )\n      )\n    ).then(() => {\n      if (this.$options.autofocus && this.$refs.modal.querySelector(this.$options.autofocus)) {\n        saveActiveElement();\n        this.$refs.modal.querySelector(this.$options.autofocus).focus();\n      }\n      return Promise.resolve(this);\n    });\n  }\n\n  /**\n   * Close the modal.\n   *\n   * @return {Modal} The Modal instance.\n   */\n  async close() {\n    if (!this.isOpen) {\n      return Promise.resolve(this);\n    }\n\n    this.$refs.modal.setAttribute('aria-hidden', 'true');\n    document.documentElement.style.overflow = '';\n\n    this.isOpen = false;\n    untrap();\n    this.$emit('close');\n\n    return Promise.all(\n      Object.entries(this.$options.styles).map(([refName, { open, active, closed } = {}]) =>\n        transition(\n          this.$refs[refName],\n          {\n            from: open,\n            active,\n            to: closed,\n          },\n          'keep'\n        )\n      )\n    ).then(() => Promise.resolve(this));\n  }\n}\n"],"file":"Modal.js"}