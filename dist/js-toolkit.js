function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}for(var o="-_",s=36;s--;)o+=s.toString(36);for(s=36;s---10;)o+=s.toString(36).toUpperCase();var a=function(e){var t="";for(s=e||21;s--;)t+=o[64*Math.random()|0];return t};function c(e,t){void 0===t&&(t=[]);var n=Object.getPrototypeOf(e);return n===Object.prototype?t:c(n,Object.getOwnPropertyNames(n).map(function(e){return[e,n]}).reduce(function(e,t){return[].concat(e,[t])},t))}var u=function(){function e(){this._events={}}var t=e.prototype;return t.$on=function(e,t){var n=this;return Array.isArray(this._events[e])||(this._events[e]=[]),this._events[e].push(t),function(){n.$off(e,t)}},t.$off=function(e,t){if(!e)return this._events={},this;if(!t)return this._events[e]=[],this;var n=this._events[e].indexOf(t);return n>-1&&this._events[e].splice(n,1),this},t.$emit=function(e){var t=arguments,n=this;return Array.isArray(this._events[e])?(this._events[e].forEach(function(e){e.apply(n,[].slice.call(t,1))}),this):this},t.$once=function(e,t){var n=this;return this.$on(e,function r(){n.$off(e,r),t.apply(n,[].slice.call(arguments))}),this},e}();function d(e){return e.$options.debug?window.console.log.apply(window,[e.config.name].concat([].slice.call(arguments,1))):function(){}}function h(e,t){return"function"==typeof e[t]}function l(e,t){var n,r=[].slice.call(arguments,2);return d.apply(void 0,[e,"callMethod",t].concat(r)),"destroyed"===t&&!e.$isMounted||"mounted"===t&&e.$isMounted?(d(e,"not",t,"because the method has already been triggered once."),e):(e.$emit.apply(e,[t].concat(r)),h(e,t)?((n=e[t]).call.apply(n,[e].concat(r)),d.apply(void 0,[e,t,e].concat(r)),e):e)}var f=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===p}(e)}(e)},p="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function v(e,t){return!1!==t.clone&&t.isMergeableObject(e)?g(Array.isArray(e)?[]:{},e,t):e}function y(e,t,n){return e.concat(t).map(function(e){return v(e,n)})}function m(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter(function(t){return e.propertyIsEnumerable(t)}):[]}(e))}function w(e,t){try{return t in e}catch(e){return!1}}function g(e,t,n){(n=n||{}).arrayMerge=n.arrayMerge||y,n.isMergeableObject=n.isMergeableObject||f,n.cloneUnlessOtherwiseSpecified=v;var r=Array.isArray(t);return r===Array.isArray(e)?r?n.arrayMerge(e,t,n):function(e,t,n){var r={};return n.isMergeableObject(e)&&m(e).forEach(function(t){r[t]=v(e[t],n)}),m(t).forEach(function(i){(function(e,t){return w(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,i)||(r[i]=w(e,i)&&n.isMergeableObject(t[i])?function(e,t){if(!t.customMerge)return g;var n=t.customMerge(e);return"function"==typeof n?n:g}(i,n)(e[i],t[i],n):v(t[i],n))}),r}(e,t,n):v(t,n)}g.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,n){return g(e,n,t)},{})};var b=g;function _(e){e.__isAsync__?e.then(function(e){return e.$mount()}):e.$mount()}function $(e){e.$children&&(d(e,"mountComponents",e.$children),Object.values(e.$children).forEach(function(e){e.forEach(_)}))}function E(e){e.__isAsync__?e.then(function(e){return e.$destroy()}):e.$destroy()}var O=function(){function e(){this.callbacks=new Map,this.isInit=!1}var n=e.prototype;return n.init=function(){throw new Error("The `init` method must be implemented.")},n.kill=function(){throw new Error("The `kill` method must be implemented.")},n.add=function(e,t){if(this.has(e))throw new Error("A callback with the key `"+e+"` has already been registered.");return 0!==this.callbacks.size||this.isInit||(this.init(),this.isInit=!0),this.callbacks.set(e,t),this},n.has=function(e){return this.callbacks.has(e)},n.get=function(e){return this.callbacks.get(e)},n.remove=function(e){return this.callbacks.delete(e),0===this.callbacks.size&&this.isInit&&(this.kill(),this.isInit=!1),this},n.trigger=function(){var e=arguments;return this.callbacks.forEach(function(t){t.apply(void 0,[].slice.call(e))}),this},t(e,[{key:"props",get:function(){throw new Error("The `props` getter must be implemented.")}}]),e}();function k(e,t){void 0===t&&(t=16);var n=0;return function(){var r=(new Date).getTime();return!(r-n<t)&&(n=r,e.apply(void 0,[].slice.call(arguments)))}}function x(e,t){var n;return void 0===t&&(t=300),function(){var r=arguments;clearTimeout(n),n=setTimeout(function(){e.apply(void 0,[].slice.call(r))},t)}}var L=function(){return"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout},A=function(e){function n(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).isTicking=!1,t}r(n,e);var i=n.prototype;return i.init=function(){var e=this,t=L();this.isTicking=!0,function n(){e.trigger(e.props),e.isTicking&&t(n)}()},i.kill=function(){this.isTicking=!1},t(n,[{key:"props",get:function(){return{time:window.performance.now()}}}]),n}(O),j=null,H=function(){return j||(j=new A),{add:j.add.bind(j),remove:j.remove.bind(j),has:j.has.bind(j),props:function(){return j.props}}},P=function(e){function n(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).isDown=!1,t.y=window.innerHeight/2,t.yLast=window.innerHeight/2,t.x=window.innerWidth/2,t.xLast=window.innerWidth/2,t}r(n,e);var i=n.prototype;return i.init=function(){var e=this,t=H(),n=t.add,r=t.remove;this.hasRaf=!1;var i=x(function(t){e.updateValues(t),r("usePointer"),e.trigger(e.props),e.hasRaf=!1},50);this.handler=k(function(t){e.updateValues(t),e.hasRaf||(n("usePointer",function(){e.trigger(e.props)}),e.hasRaf=!0),i(t)},32).bind(this),this.downHandler=this.downHandler.bind(this),this.upHandler=this.upHandler.bind(this),document.documentElement.addEventListener("mouseenter",this.handler,{once:!0}),document.addEventListener("mousemove",this.handler,{passive:!0}),document.addEventListener("touchmove",this.handler,{passive:!0}),document.addEventListener("mousedown",this.downHandler,{passive:!0}),document.addEventListener("touchstart",this.downHandler,{passive:!0}),document.addEventListener("mouseup",this.upHandler,{passive:!0}),document.addEventListener("touchend",this.upHandler,{passive:!0})},i.kill=function(){document.removeEventListener("mousemove",this.handler),document.removeEventListener("touchmove",this.handler),document.removeEventListener("mousedown",this.downHandler),document.removeEventListener("touchstart",this.downHandler),document.removeEventListener("mouseup",this.upHandler),document.removeEventListener("touchend",this.upHandler)},i.downHandler=function(){this.isDown=!0,this.trigger(this.props)},i.upHandler=function(){this.isDown=!1,this.trigger(this.props)},i.updateValues=function(e){this.yLast=this.y,this.xLast=this.x,((e.touches||[])[0]||e||{}).clientY!==this.y&&(this.y=((e.touches||[])[0]||e||{}).clientY),((e.touches||[])[0]||e||{}).clientX!==this.x&&(this.x=((e.touches||[])[0]||e||{}).clientX)},t(n,[{key:"props",get:function(){return{isDown:this.isDown,x:this.x,y:this.y,changed:{x:this.x!==this.xLast,y:this.y!==this.yLast},last:{x:this.xLast,y:this.yLast},delta:{x:this.x-this.xLast,y:this.y-this.yLast},progress:{x:this.x/window.innerWidth,y:this.y/window.innerHeight},max:{x:window.innerWidth,y:window.innerHeight}}}}]),n}(O),S=null,C=function(){return S||(S=new P),{add:S.add.bind(S),remove:S.remove.bind(S),has:S.has.bind(S),props:function(){return S.props}}},z=function(e){function n(){return e.apply(this,arguments)||this}r(n,e);var i=n.prototype;return i.init=function(){var e=this;this.handler=x(function(){e.trigger(e.props)}).bind(this),this.canUseResizeObserver?(this.resizeObserver=new ResizeObserver(this.handler),this.resizeObserver.observe(document.documentElement)):window.addEventListener("resize",this.handler)},i.kill=function(){this.canUseResizeObserver?this.resizeObserver.disconnect():window.removeEventListener("resize",this.handler),delete this.resizeObserver},t(n,[{key:"props",get:function(){var e={width:window.innerWidth,height:window.innerHeight,ratio:window.innerWidth/window.innerHeight,orientation:"square"};return e.ratio>1&&(e.orientation="landscape"),e.ratio<1&&(e.orientation="portrait"),this.breakpointElement&&(e.breakpoint=this.breakpoint,e.breakpoints=this.breakpoints),e}},{key:"breakpointElement",get:function(){return document.querySelector("[data-breakpoint]")||null}},{key:"breakpoint",get:function(){return window.getComputedStyle(this.breakpointElement,"::before").getPropertyValue("content").replace(/"/g,"")}},{key:"breakpoints",get:function(){return window.getComputedStyle(this.breakpointElement,"::after").getPropertyValue("content").replace(/"/g,"").split(",")}},{key:"canUseResizeObserver",get:function(){return void 0!==window.ResizeObserver}}]),n}(O),M=null,T=function(){return M||(M=new z),{add:M.add.bind(M),remove:M.remove.bind(M),has:M.has.bind(M),props:function(){return M.props}}},R=function(e){function n(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).y=window.pageYOffset,t.yLast=window.pageYOffset,t.x=window.pageXOffset,t.xLast=window.pageXOffset,t}r(n,e);var i=n.prototype;return i.init=function(){var e=this,t=x(function(){e.trigger(e.props),function(e){void 0===e&&(e=function(){});var t=L();new Promise(function(n){t(function(){return t(function(){return n(e())})})})}(function(){e.trigger(e.props)})},50);this.handler=k(function(){e.trigger(e.props),t()},32).bind(this),document.addEventListener("scroll",this.handler,{passive:!0})},i.kill=function(){document.removeEventListener("scroll",this.handler)},t(n,[{key:"props",get:function(){return this.yLast=this.y,this.xLast=this.x,window.pageYOffset!==this.y&&(this.y=window.pageYOffset),window.pageXOffset!==this.x&&(this.x=window.pageXOffset),{x:this.x,y:this.y,changed:{x:this.x!==this.xLast,y:this.y!==this.yLast},last:{x:this.xLast,y:this.yLast},delta:{x:this.x-this.xLast,y:this.y-this.yLast},progress:{x:0===this.max.x?1:this.x/this.max.x,y:0===this.max.y?1:this.y/this.max.y},max:this.max}}},{key:"max",get:function(){return{x:(document.scrollingElement||document.body).scrollWidth-window.innerWidth,y:(document.scrollingElement||document.body).scrollHeight-window.innerHeight}}}]),n}(O),W=null,D=function(){return W||(W=new R),{add:W.add.bind(W),remove:W.remove.bind(W),has:W.has.bind(W),props:function(){return W.props}}},I={ENTER:13,SPACE:32,TAB:9,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40},q=function(e){function i(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).event={},t.triggered=0,t.previousEvent={},t}r(i,e);var o=i.prototype;return o.init=function(){var e=this;this.handler=function(t){e.event=t,e.trigger(e.props)},document.addEventListener("keydown",this.handler,{passive:!1}),document.addEventListener("keyup",this.handler,{passive:!1})},o.kill=function(){document.removeEventListener("keydown",this.handler),document.removeEventListener("keyup",this.handler)},t(i,[{key:"props",get:function(){var e=this,t=Object.entries(I).reduce(function(t,n){return t[n[0]]=n[1]===e.event.keyCode,t},{});return this.previousEvent.type||(this.triggered=0),"keydown"===this.event.type&&"keydown"===this.previousEvent.type?this.triggered+=1:this.triggered=1,this.previousEvent=this.event,n({event:this.event,triggered:this.triggered,direction:"keydown"===this.event.type?"down":"up",isUp:"keyup"===this.event.type,isDown:"keydown"===this.event.type},t)}}]),i}(O),U=null,N=function(){return U||(U=new q),{add:U.add.bind(U),remove:U.remove.bind(U),has:U.has.bind(U),props:function(){return U.props}}};function X(e,t,n){if(!h(e,t))return function(){};var r=n(),i=r.remove;return(0,r.add)(e.$id,function(){l.apply(void 0,[e,t].concat([].slice.call(arguments)))}),function(){return i(e.$id)}}function Y(e){var t=[X(e,"scrolled",D),X(e,"resized",T),X(e,"ticked",H),X(e,"moved",C),X(e,"keyed",N)];if(h(e,"loaded")){var n=function(t){l(e,"loaded",{event:t})};window.addEventListener("load",n),t.push(function(){window.removeEventListener("load",n)})}return t}function B(e){var t=/^on[A-Z][a-z]+$/,n=/^on([A-Z][a-z]+)([A-Z][a-z]+)+$/,r=c(e).reduce(function(e,r){var i=r[0];return t.test(i)?(e.root.push(i),e):(n.test(i)&&e.refsOrChildren.push(i),e)},{root:[],refsOrChildren:[]});return[].concat(function(e,t){return t.map(function(t){var n=t.replace(/^on/,"").toLowerCase(),r=function(){var n=[].slice.call(arguments);d.apply(void 0,[e,t,e.$el].concat(n)),e[t].apply(e,n)};return e.$el.addEventListener(n,r),function(){e.$el.removeEventListener(n,r)}})}(e,r.root),function(e,t){var n=[];return Object.entries(e.$refs).forEach(function(r){var i=r[0],o=r[1],s=Array.isArray(o)?o:[o],a="on"+i.replace(/^\w/,function(e){return e.toUpperCase()});t.filter(function(e){return e.startsWith(a)}).forEach(function(r){s.forEach(function(o,s){var c=r.replace(a,"").toLowerCase(),u=function(){var t=[].slice.call(arguments);d.apply(void 0,[e,r,o].concat(t,[s])),e[r].apply(e,t.concat([s]))};d(e,"binding ref event",i,c),o.constructor&&o.constructor.__isBase__&&(o=o.$el),o.addEventListener(c,u),n.push(function(){d(e,"unbinding ref event",t),o.removeEventListener(c,u)})})})}),n}(e,r.refsOrChildren),function(e,t){var n=[];return Object.entries(e.$children).forEach(function(r){var i=r[0],o=r[1],s="on"+i.replace(/^\w/,function(e){return e.toUpperCase()});t.filter(function(e){return e.startsWith(s)}).forEach(function(t){o.forEach(function(r,o){var a=t.replace(s,"").toLowerCase();d(e,"binding child event",i,a);var c=r.$on(a,function(){var n=[].slice.call(arguments);d.apply(void 0,[e,t,r].concat(n,[o])),e[t].apply(e,n.concat([o]))});n.push(function(){d(e,"unbinding child event",i,a),c()})})})}),n}(e,r.refsOrChildren))}var J=function(e){function n(t){var n;if(!(n=e.call(this)||this).config)throw new Error("The `config` getter must be defined.");if(!n.config.name)throw new Error("The `config.name` property is required.");if(!t)throw new Error("The root element must be defined.");Object.defineProperties(i(n),{$id:{value:n.config.name+"-"+a()},$isMounted:{value:!1,writable:!0},$el:{value:t}}),n.$el.__base__||Object.defineProperty(n.$el,"__base__",{get:function(){return i(n)},configurable:!0}),function(e,t){var n=void 0===t?{}:t,r=n.include,i=n.exclude;c(e).filter(function(e){var t=e[0];return"constructor"!==t&&function(e){var t=function(t){return"string"==typeof t?e===t:t.test(e)};return r?r.some(t):!i||!i.some(t)}(t)}).forEach(function(t){var n=t[0],r=Object.getOwnPropertyDescriptor(t[1],n);r&&"function"==typeof r.value&&(e[n]=e[n].bind(e))})}(i(n),{exclude:["$mount","$destroy","$log","$on","$once","$off","$emit","mounted","loaded","ticked","resized","moved","keyed","scrolled","destroyed"].concat(n._excludeFromAutoBind||[])});var r=[];return n.$on("mounted",function(){$(i(n)),r=[].concat(Y(i(n)),B(i(n))),n.$isMounted=!0}),n.$on("updated",function(){r.forEach(function(e){return e()}),$(i(n)),r=[].concat(Y(i(n)),B(i(n)))}),n.$on("destroyed",function(){n.$isMounted=!1,r.forEach(function(e){return e()}),function(e){e.$children&&(d(e,"destroyComponents",e.$children),Object.values(e.$children).forEach(function(e){e.forEach(E)}))}(i(n))}),n.__isChild__||(n.$mount(),Object.defineProperty(i(n),"$parent",{get:function(){return null}})),d(i(n),"constructor",i(n)),i(n)||i(n)}r(n,e),t(n,[{key:"$refs",get:function(){return function(e,t){var n=Array.from(t.querySelectorAll("[data-ref]")),r=Array.from(t.querySelectorAll(":scope [data-component] [data-ref]")),i=n.filter(function(e){return!r.includes(e)}).reduce(function(e,t){var n=t.dataset.ref,r=t.__base__?t.__base__:t;return n.endsWith("[]")&&(e[n=n.replace(/\[\]$/,"")]||(e[n]=[])),e[n]?Array.isArray(e[n])?e[n].push(r):e[n]=[e[n],r]:e[n]=r,e},{});return e.$emit("get:refs",i),i}(this,this.$el)}},{key:"$children",get:function(){return function(e,t,n){var r=Object.entries(n).reduce(function(n,r){var i=r[0],o=r[1],s=Array.from(t.querySelectorAll('[data-component="'+i+'"]'));return 0===s.length&&(s=Array.from(t.querySelectorAll(i))),0===s.length||(n[i]=s.map(function(t){return function(e,t,n){if(e.__base__)return e.__base__;if(t.__isBase__){Object.defineProperty(t.prototype,"__isChild__",{value:!0});var r=new t(e);return Object.defineProperty(r,"$parent",{get:function(){return n}}),r}var i=t().then(function(t){var r=t.default?t.default:t;Object.defineProperty(r.prototype,"__isChild__",{value:!0});var i=new r(e);return Object.defineProperty(i,"$parent",{get:function(){return n}}),i});return i.__isAsync__=!0,i}(t,o,e)}).filter(function(e){return"terminated"!==e}),0===n[i].length&&delete n[i]),n},{});return e.$emit("get:children",r),r}(this,this.$el,this.config.components||{})}},{key:"$options",get:function(){return function(e,t,n){var r={};if(t.dataset.options)try{r=JSON.parse(t.dataset.options)}catch(e){throw new Error("Can not parse the `data-options` attribute. Is it a valid JSON string?")}return r=b(n,r),e.$emit("get:options",r),r}(this,this.$el,this.config)},set:function(e){!function(e,t,n){var r={};if(t.dataset.options)try{r=JSON.parse(t.dataset.options)}catch(e){throw new Error("Can not parse the `data-options` attribute. Is it a valid JSON string?")}r=b(r,n),t.dataset.options=JSON.stringify(r)}(0,this.$el,e)}}]);var o=n.prototype;return o.$log=function(){return this.$options.log?window.console.log.apply(window,[this.config.name].concat([].slice.call(arguments))):function(){}},o.$mount=function(){return d(this,"$mount"),l(this,"mounted"),this},o.$update=function(){return d(this,"$update"),l(this,"updated"),this},o.$destroy=function(){return d(this,"$destroy"),l(this,"destroyed"),this},o.$terminate=function(){d(this,"$terminate"),this.$destroy(),l(this,"terminated"),delete this.$el.__base__,Object.defineProperty(this.$el,"__base__",{value:"terminated",configurable:!1,writable:!1})},n}(u);J.__isBase__=!0,module.exports=J;
//# sourceMappingURL=js-toolkit.js.map
