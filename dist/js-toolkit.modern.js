for(var e="-_",t=36;t--;)e+=t.toString(36);for(t=36;t---10;)e+=t.toString(36).toUpperCase();var n=function(n){var r="";for(t=n||21;t--;)r+=e[64*Math.random()|0];return r};function r(e,t=[]){const n=Object.getPrototypeOf(e);return n===Object.prototype?t:r(n,Object.getOwnPropertyNames(n).map(e=>[e,n]).reduce((e,t)=>[...e,t],t))}function i(e,...t){return e.$options.debug?window.console.log.apply(window,[e.config.name,...t]):()=>{}}function s(e,t){return"function"==typeof e[t]}function o(e,t,...n){return i(e,"callMethod",t,...n),"destroyed"===t&&!e.$isMounted||"mounted"===t&&e.$isMounted?(i(e,"not",t,"because the method has already been triggered once."),e):(e.$emit(t,...n),s(e,t)?(e[t].call(e,...n),i(e,t,e,...n),e):e)}var a=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===h}(e)}(e)},h="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function d(e,t){return!1!==t.clone&&t.isMergeableObject(e)?p(Array.isArray(e)?[]:{},e,t):e}function c(e,t,n){return e.concat(t).map(function(e){return d(e,n)})}function u(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter(function(t){return e.propertyIsEnumerable(t)}):[]}(e))}function l(e,t){try{return t in e}catch(e){return!1}}function p(e,t,n){(n=n||{}).arrayMerge=n.arrayMerge||c,n.isMergeableObject=n.isMergeableObject||a,n.cloneUnlessOtherwiseSpecified=d;var r=Array.isArray(t);return r===Array.isArray(e)?r?n.arrayMerge(e,t,n):function(e,t,n){var r={};return n.isMergeableObject(e)&&u(e).forEach(function(t){r[t]=d(e[t],n)}),u(t).forEach(function(i){(function(e,t){return l(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,i)||(r[i]=l(e,i)&&n.isMergeableObject(t[i])?function(e,t){if(!t.customMerge)return p;var n=t.customMerge(e);return"function"==typeof n?n:p}(i,n)(e[i],t[i],n):d(t[i],n))}),r}(e,t,n):d(t,n)}p.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,n){return p(e,n,t)},{})};var f=p;function m(e){e.__isAsync__?e.then(e=>e.$mount()):e.$mount()}function y(e){e.$children&&(i(e,"mountComponents",e.$children),Object.values(e.$children).forEach(e=>{e.forEach(m)}))}function g(e){e.__isAsync__?e.then(e=>e.$destroy()):e.$destroy()}class w{constructor(){this.callbacks=new Map,this.isInit=!1}get props(){throw new Error("The `props` getter must be implemented.")}init(){throw new Error("The `init` method must be implemented.")}kill(){throw new Error("The `kill` method must be implemented.")}add(e,t){if(this.has(e))throw new Error(`A callback with the key \`${e}\` has already been registered.`);return 0!==this.callbacks.size||this.isInit||(this.init(),this.isInit=!0),this.callbacks.set(e,t),this}has(e){return this.callbacks.has(e)}get(e){return this.callbacks.get(e)}remove(e){return this.callbacks.delete(e),0===this.callbacks.size&&this.isInit&&(this.kill(),this.isInit=!1),this}trigger(...e){return this.callbacks.forEach(t=>{t(...e)}),this}}function v(e,t=16){let n=0;return(...r)=>{const i=(new Date).getTime();return!(i-n<t)&&(n=i,e(...r))}}function b(e,t=300){let n;return(...r)=>{clearTimeout(n),n=setTimeout(()=>{e(...r)},t)}}const $=()=>"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout;class _ extends w{constructor(...e){super(...e),this.isTicking=!1}init(){const e=$(),t=()=>{this.trigger(this.props),this.isTicking&&e(t)};this.isTicking=!0,t()}kill(){this.isTicking=!1}get props(){return{time:window.performance.now()}}}let E=null;var O=()=>(E||(E=new _),{add:E.add.bind(E),remove:E.remove.bind(E),has:E.has.bind(E),props:()=>E.props});class x extends w{constructor(...e){super(...e),this.isDown=!1,this.y=window.innerHeight/2,this.yLast=window.innerHeight/2,this.x=window.innerWidth/2,this.xLast=window.innerWidth/2}init(){const{add:e,remove:t}=O();this.hasRaf=!1;const n=b(e=>{this.updateValues(e),t("usePointer"),this.trigger(this.props),this.hasRaf=!1},50);this.handler=v(t=>{this.updateValues(t),this.hasRaf||(e("usePointer",()=>{this.trigger(this.props)}),this.hasRaf=!0),n(t)},32).bind(this),this.downHandler=this.downHandler.bind(this),this.upHandler=this.upHandler.bind(this),document.documentElement.addEventListener("mouseenter",this.handler,{once:!0}),document.addEventListener("mousemove",this.handler,{passive:!0}),document.addEventListener("touchmove",this.handler,{passive:!0}),document.addEventListener("mousedown",this.downHandler,{passive:!0}),document.addEventListener("touchstart",this.downHandler,{passive:!0}),document.addEventListener("mouseup",this.upHandler,{passive:!0}),document.addEventListener("touchend",this.upHandler,{passive:!0})}kill(){document.removeEventListener("mousemove",this.handler),document.removeEventListener("touchmove",this.handler),document.removeEventListener("mousedown",this.downHandler),document.removeEventListener("touchstart",this.downHandler),document.removeEventListener("mouseup",this.upHandler),document.removeEventListener("touchend",this.upHandler)}downHandler(){this.isDown=!0,this.trigger(this.props)}upHandler(){this.isDown=!1,this.trigger(this.props)}updateValues(e){this.yLast=this.y,this.xLast=this.x,((e.touches||[])[0]||e||{}).clientY!==this.y&&(this.y=((e.touches||[])[0]||e||{}).clientY),((e.touches||[])[0]||e||{}).clientX!==this.x&&(this.x=((e.touches||[])[0]||e||{}).clientX)}get props(){return{isDown:this.isDown,x:this.x,y:this.y,changed:{x:this.x!==this.xLast,y:this.y!==this.yLast},last:{x:this.xLast,y:this.yLast},delta:{x:this.x-this.xLast,y:this.y-this.yLast},progress:{x:this.x/window.innerWidth,y:this.y/window.innerHeight},max:{x:window.innerWidth,y:window.innerHeight}}}}let L=null;var k=()=>(L||(L=new x),{add:L.add.bind(L),remove:L.remove.bind(L),has:L.has.bind(L),props:()=>L.props});class A extends w{init(){this.handler=b(()=>{this.trigger(this.props)}).bind(this),this.canUseResizeObserver?(this.resizeObserver=new ResizeObserver(this.handler),this.resizeObserver.observe(document.documentElement)):window.addEventListener("resize",this.handler)}kill(){this.canUseResizeObserver?this.resizeObserver.disconnect():window.removeEventListener("resize",this.handler),delete this.resizeObserver}get props(){const e={width:window.innerWidth,height:window.innerHeight,ratio:window.innerWidth/window.innerHeight,orientation:"square"};return e.ratio>1&&(e.orientation="landscape"),e.ratio<1&&(e.orientation="portrait"),this.breakpointElement&&(e.breakpoint=this.breakpoint,e.breakpoints=this.breakpoints),e}get breakpointElement(){return document.querySelector("[data-breakpoint]")||null}get breakpoint(){return window.getComputedStyle(this.breakpointElement,"::before").getPropertyValue("content").replace(/"/g,"")}get breakpoints(){return window.getComputedStyle(this.breakpointElement,"::after").getPropertyValue("content").replace(/"/g,"").split(",")}get canUseResizeObserver(){return void 0!==window.ResizeObserver}}let j=null;var H=()=>(j||(j=new A),{add:j.add.bind(j),remove:j.remove.bind(j),has:j.has.bind(j),props:()=>j.props});class S extends w{constructor(...e){super(...e),this.y=window.pageYOffset,this.yLast=window.pageYOffset,this.x=window.pageXOffset,this.xLast=window.pageXOffset}init(){const e=b(()=>{this.trigger(this.props),function(e=(()=>{})){const t=$();new Promise(n=>{t(()=>t(()=>n(e())))})}(()=>{this.trigger(this.props)})},50);this.handler=v(()=>{this.trigger(this.props),e()},32).bind(this),document.addEventListener("scroll",this.handler,{passive:!0})}kill(){document.removeEventListener("scroll",this.handler)}get props(){return this.yLast=this.y,this.xLast=this.x,window.pageYOffset!==this.y&&(this.y=window.pageYOffset),window.pageXOffset!==this.x&&(this.x=window.pageXOffset),{x:this.x,y:this.y,changed:{x:this.x!==this.xLast,y:this.y!==this.yLast},last:{x:this.xLast,y:this.yLast},delta:{x:this.x-this.xLast,y:this.y-this.yLast},progress:{x:0===this.max.x?1:this.x/this.max.x,y:0===this.max.y?1:this.y/this.max.y},max:this.max}}get max(){return{x:(document.scrollingElement||document.body).scrollWidth-window.innerWidth,y:(document.scrollingElement||document.body).scrollHeight-window.innerHeight}}}let C=null;var P=()=>(C||(C=new S),{add:C.add.bind(C),remove:C.remove.bind(C),has:C.has.bind(C),props:()=>C.props});function z(){return(z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var M={ENTER:13,SPACE:32,TAB:9,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40};class T extends w{constructor(...e){super(...e),this.event={},this.triggered=0,this.previousEvent={}}init(){this.handler=e=>{this.event=e,this.trigger(this.props)},document.addEventListener("keydown",this.handler,{passive:!1}),document.addEventListener("keyup",this.handler,{passive:!1})}kill(){document.removeEventListener("keydown",this.handler),document.removeEventListener("keyup",this.handler)}get props(){const e=Object.entries(M).reduce((e,[t,n])=>(e[t]=n===this.event.keyCode,e),{});return this.previousEvent.type||(this.triggered=0),"keydown"===this.event.type&&"keydown"===this.previousEvent.type?this.triggered+=1:this.triggered=1,this.previousEvent=this.event,z({event:this.event,triggered:this.triggered,direction:"keydown"===this.event.type?"down":"up",isUp:"keyup"===this.event.type,isDown:"keydown"===this.event.type},e)}}let R=null;var W=()=>(R||(R=new T),{add:R.add.bind(R),remove:R.remove.bind(R),has:R.has.bind(R),props:()=>R.props});function D(e,t,n){if(!s(e,t))return()=>{};const{add:r,remove:i}=n();return r(e.$id,(...n)=>{o(e,t,...n)}),()=>i(e.$id)}function I(e){const t=[D(e,"scrolled",P),D(e,"resized",H),D(e,"ticked",O),D(e,"moved",k),D(e,"keyed",W)];if(s(e,"loaded")){const n=t=>{o(e,"loaded",{event:t})};window.addEventListener("load",n),t.push(()=>{window.removeEventListener("load",n)})}return t}function q(e,t){return t.map(t=>{const n=t.replace(/^on/,"").toLowerCase(),r=(...n)=>{i(e,t,e.$el,...n),e[t](...n)};return e.$el.addEventListener(n,r),()=>{e.$el.removeEventListener(n,r)}})}function U(e,t){const n=[];return Object.entries(e.$refs).forEach(([r,s])=>{const o=Array.isArray(s)?s:[s],a="on"+r.replace(/^\w/,e=>e.toUpperCase());t.filter(e=>e.startsWith(a)).forEach(s=>{o.forEach((o,h)=>{const d=s.replace(a,"").toLowerCase(),c=(...t)=>{i(e,s,o,...t,h),e[s](...t,h)};i(e,"binding ref event",r,d),o.constructor&&o.constructor.__isBase__&&(o=o.$el),o.addEventListener(d,c),n.push(()=>{i(e,"unbinding ref event",t),o.removeEventListener(d,c)})})})}),n}function N(e,t){const n=[];return Object.entries(e.$children).forEach(([r,s])=>{const o="on"+r.replace(/^\w/,e=>e.toUpperCase());t.filter(e=>e.startsWith(o)).forEach(t=>{s.forEach((s,a)=>{const h=t.replace(o,"").toLowerCase();i(e,"binding child event",r,h);const d=s.$on(h,(...n)=>{i(e,t,s,...n,a),e[t](...n,a)});n.push(()=>{i(e,"unbinding child event",r,h),d()})})})}),n}function X(e){const t=/^on[A-Z][a-z]+$/,n=/^on([A-Z][a-z]+)([A-Z][a-z]+)+$/,i=r(e).reduce((e,[r])=>t.test(r)?(e.root.push(r),e):(n.test(r)&&e.refsOrChildren.push(r),e),{root:[],refsOrChildren:[]});return[...q(e,i.root),...U(e,i.refsOrChildren),...N(e,i.refsOrChildren)]}class Y extends class{constructor(){this._events={}}$on(e,t){return Array.isArray(this._events[e])||(this._events[e]=[]),this._events[e].push(t),()=>{this.$off(e,t)}}$off(e,t){if(!e)return this._events={},this;if(!t)return this._events[e]=[],this;const n=this._events[e].indexOf(t);return n>-1&&this._events[e].splice(n,1),this}$emit(e,...t){return Array.isArray(this._events[e])?(this._events[e].forEach(e=>{e.apply(this,t)}),this):this}$once(e,t){const n=this;return this.$on(e,function r(...i){n.$off(e,r),t.apply(n,i)}),this}}{get $refs(){return function(e,t){const n=Array.from(t.querySelectorAll("[data-ref]")),r=Array.from(t.querySelectorAll(":scope [data-component] [data-ref]")),i=n.filter(e=>!r.includes(e)).reduce((e,t)=>{let n=t.dataset.ref;const r=t.__base__?t.__base__:t;return n.endsWith("[]")&&(n=n.replace(/\[\]$/,""),e[n]||(e[n]=[])),e[n]?Array.isArray(e[n])?e[n].push(r):e[n]=[e[n],r]:e[n]=r,e},{});return e.$emit("get:refs",i),i}(this,this.$el)}get $children(){return function(e,t,n){const r=Object.entries(n).reduce((n,[r,i])=>{let s=Array.from(t.querySelectorAll(`[data-component="${r}"]`));return 0===s.length&&(s=Array.from(t.querySelectorAll(r))),0===s.length||(n[r]=s.map(t=>function(e,t,n){if(e.__base__)return e.__base__;if(t.__isBase__){Object.defineProperty(t.prototype,"__isChild__",{value:!0});const r=new t(e);return Object.defineProperty(r,"$parent",{get:()=>n}),r}const r=t().then(t=>{const r=t.default?t.default:t;Object.defineProperty(r.prototype,"__isChild__",{value:!0});const i=new r(e);return Object.defineProperty(i,"$parent",{get:()=>n}),i});return r.__isAsync__=!0,r}(t,i,e)).filter(e=>"terminated"!==e),0===n[r].length&&delete n[r]),n},{});return e.$emit("get:children",r),r}(this,this.$el,this.config.components||{})}get $options(){return function(e,t,n){let r={};if(t.dataset.options)try{r=JSON.parse(t.dataset.options)}catch(e){throw new Error("Can not parse the `data-options` attribute. Is it a valid JSON string?")}return r=f(n,r),e.$emit("get:options",r),r}(this,this.$el,this.config)}set $options(e){!function(e,t,n){let r={};if(t.dataset.options)try{r=JSON.parse(t.dataset.options)}catch(e){throw new Error("Can not parse the `data-options` attribute. Is it a valid JSON string?")}r=f(r,n),t.dataset.options=JSON.stringify(r)}(0,this.$el,e)}constructor(e){if(super(),!this.config)throw new Error("The `config` getter must be defined.");if(!this.config.name)throw new Error("The `config.name` property is required.");if(!e)throw new Error("The root element must be defined.");Object.defineProperties(this,{$id:{value:`${this.config.name}-${n()}`},$isMounted:{value:!1,writable:!0},$el:{value:e}}),this.$el.__base__||Object.defineProperty(this.$el,"__base__",{get:()=>this,configurable:!0}),function(e,{include:t,exclude:n}={}){r(e).filter(([e])=>"constructor"!==e&&(e=>{const r=t=>"string"==typeof t?e===t:t.test(e);return t?t.some(r):!n||!n.some(r)})(e)).forEach(([t,n])=>{const r=Object.getOwnPropertyDescriptor(n,t);r&&"function"==typeof r.value&&(e[t]=e[t].bind(e))})}(this,{exclude:["$mount","$destroy","$log","$on","$once","$off","$emit","mounted","loaded","ticked","resized","moved","keyed","scrolled","destroyed",...this._excludeFromAutoBind||[]]});let t=[];return this.$on("mounted",()=>{y(this),t=[...I(this),...X(this)],this.$isMounted=!0}),this.$on("updated",()=>{t.forEach(e=>e()),y(this),t=[...I(this),...X(this)]}),this.$on("destroyed",()=>{this.$isMounted=!1,t.forEach(e=>e()),function(e){e.$children&&(i(e,"destroyComponents",e.$children),Object.values(e.$children).forEach(e=>{e.forEach(g)}))}(this)}),this.__isChild__||(this.$mount(),Object.defineProperty(this,"$parent",{get:()=>null})),i(this,"constructor",this),this}$log(...e){return this.$options.log?window.console.log.apply(window,[this.config.name,...e]):()=>{}}$mount(){return i(this,"$mount"),o(this,"mounted"),this}$update(){return i(this,"$update"),o(this,"updated"),this}$destroy(){return i(this,"$destroy"),o(this,"destroyed"),this}$terminate(){i(this,"$terminate"),this.$destroy(),o(this,"terminated"),delete this.$el.__base__,Object.defineProperty(this.$el,"__base__",{value:"terminated",configurable:!1,writable:!1})}}Y.__isBase__=!0;export default Y;
//# sourceMappingURL=js-toolkit.modern.js.map
